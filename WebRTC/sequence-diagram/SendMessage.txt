@startuml

title Send message Sequence

participant "Endpoint A" as EPA
participant "AT&T API Gateway" as GW
participant "Endpoint B" as EPB

note over EPA, EPB
1. EndPoints are registered with Gateway
2. EndPoints have established event channel to get notification of network events. 
end note
autonumber 
loop Long polling 
EPA->GW: GET /sessions/{sessionId}/events 
end

alt Send Text Message
EPA -> GW: POST /sessions/{sessionId}/groups/{groupId}/chats (msg)
end

autonumber 2
note over EPA:Media content sent\n in HTTP body
alt Send Media Message 
EPA -> GW:POST /sessions/{sessionId}/groups/{groupId}/chats
end


autonumber 2
alt Send Is-Composing Notification
EPA -> GW:POST /sessions/{sessionId}/groups/{groupId}/chats(state, refresh)
end

GW-->EPA: 202 | Accepted (<b>msgId</b>)

autonumber 2
loop Long polling
EPB->GW: GET /sessions/{sessionId}/events
alt Receive Message Event
GW-->EPB: 200 OK event{@type=groups, subType=chat,from,contentType,body,type}
end

autonumber 3
alt Receive Media Event
GW-->EPB:200 OK  event(@type=groups, subType=media,from,mediaUrl}
end

autonumber 3
alt Receive Is-Composing Event
GW-->EPB:200 OK  event{@type=groups, subType=is-composing,from,url,size}
end
end

@enduml