@startuml


hide footbox

title Sequence for Conference
participant "<b>WebRTC App - Conference Host" as ConfHost
participant "<b>APIGW" as apig
participant "<b>Conference Participant 1" as ConfPart1
participant "<b>Conference Participant 2" as ConfPart2

autonumber

note over ConfHost
<b>Pre-Conditions
1. oAUTH Token is successfully 
allocated to the user.
2. User Session is registered.
end note
group Create a Conference
ConfHost->apig:POST /sessions/{sessionId}/conferences/
apig-->ConfHost:202 Accepted (confId)
end


group event(long polling) - open a channel for communication.
ConfHost->apig:GET /sessions/{sessionId}/events/
apig-->ConfHost:200 Ok (session-open,Connection IP address) 
end

note over ConfHost,apig
<b>Establish Media Path for communication (voicevideo)
end note

group ADD Participant 1
ConfHost->apig:PUT /sessions/{sessionId}/conferences/{confId}/participants/{participantId}
apig-->ConfHost:204 No content (add-pending) 
end

note over ConfPart1
In case Participant is a 
webRTC user an Event will 
be received on the event channel
end note

ConfPart1->ConfPart1 : user receives alert

ConfPart1->ConfPart1 : user answers
note over ConfPart1
In case Participant is a 
webRTC client a HTTP 
PUT on conferences/conferencesId
indicating answer in the header will 
be triggered towards APIGW
end note

note over apig,ConfPart1
<b>Establish Media Path for communication (voicevideo)
end note

apig-->ConfHost : HTTP 200 Ok (participant 1, session-open)

group ADD Participant 2
ConfHost->apig:PUT /sessions/{sessionId}/conferences/{confId}/participants/{participantId}
apig-->ConfHost:204 No content (add-pending) 
end

note over ConfPart2
In case Participant is a 
webRTC user an Event will 
be received on the event channel
end note

ConfPart2->ConfPart2 : user receives alert

ConfPart2->ConfPart2 : user answers
note over ConfPart2
In case Participant is a 
webRTC client a HTTP 
PUT on conferences/conferencesId
indicating answer in the header will 
be triggered towards APIGW
end note

note over apig,ConfPart2
<b>Establish Media Path for communication (voicevideo)
end note
apig-->ConfHost : HTTP 200 Ok (participant 2, session-open)


group Participant 1 Leaves 
ConfPart1->apig: DELETE /sessions/{sessionId}/conferences/{conferencesId}
apig-->ConfPart1: HTTP 200 Ok

end

group End Conference
ConfHost->apig: DELETE /sessions/{sessionId}/conferences/{conferencesId}
apig-->ConfHost: HTTP 200 Ok
note over ConfHost
Only Host can End the conference. 
end note
end


@enduml