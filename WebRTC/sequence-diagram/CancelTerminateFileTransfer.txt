@startuml

title Cancel/Terminate File Transfer Sequence

' Diagram for Cancel/Terminate File Transfer Sequence
' Rajender Saini
' WebRTC Api


participant "Endpoint A" as EPA
participant "AT&T API Gateway" as Gateway
participant "Endpoint B" as EPB


note over EPA, EPB
1. Endpoint have valid session established with gateway.
2. Endpoint have established event channel to get notification of network events. 
end note


note over EPA, Gateway
1.a Endpoint A decides to cancel the invitation request before endpoint B
     accept the invitation.
end note

alt Cancel file transfer invitation
EPA -> Gateway:DELETE /sessions/{sessionId}/files/{fileId}(x-delete-reason:cancel)
Gateway-->EPA: 204 No Content
end

note over EPA, Gateway
1.b Enpoint A completed the file upload.
end note

alt End file transfer
EPA -> Gateway:DELETE /sessions/{sessionId}/files/{fileId}
Gateway-->EPA: 204 No Content
end

loop Long polling 
EPB->Gateway: GET /sessions/{sessionId}/events
Gateway-->EPB: 200 OK (events)
note over Gateway, EPB
2.a,2.b Endpoint B receives file transfer cancel or end event on event
   channel with following details.
   event(type=files, subType=transfer, state=session-terminated)
end note
end

@enduml