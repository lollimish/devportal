@startuml

hide footbox
actor browser
title  <b><u>Ongoing conference session handling</u></b>
participant "<b>Dev Server" as dhs
participant "<b>APIGW" as apig


note over browser,dhs  
 User is registered and 
does have a <b>session ID</b>
end note 
group 1. <b>Accept/Answer an media conference  
browser->apig : <b>HTTP PUT</b>   /v1/sessions/sessionId/mediaConferences/{confId}(sdp,header:conference-answer)
note over apig 
    <b>"session-open"</b> - sent to conferenceer
     over the <b>event channel</b> , if present
end note
apig-->browser :HTTP 204 No Content (state:accepted)

end

note over browser,dhs  
1. User is registered and 
does have a <b>session ID</b>
2. state of conference is <b>"session-open".
end note 
group 2. <b>Initiate audio video session modifications  
browser->apig : <b>HTTP PUT</b>   /v1/sessions/sessionId/mediaConferences/{confId}(sdp,header:initiate-conference-mod)
note over apig 
    modified SDP - sent to the peer
    over the <b>event channel, if present
end note
apig-->browser :HTTP 204 No Content (state:mod-sent,modID)

end


note over browser,dhs  
1. User is registered and 
does have a <b>session ID</b>
2. state of conference is <b>"session-open".
end note 
group 3. <b>Initiate audio video conference HOLD  
browser->apig : <b>HTTP PUT</b>   /v1/sessions/sessionId/mediaConferences/{confId}(sdp->a:recvonly,header:initiate-conference-hold)
note over apig 
    modified SDP[a:recvonly] - sent 
    to the peer over the
    <b>event channel, if present
end note
apig-->browser :HTTP 204 No Content (state:mod-sent,modID)

end

note over browser,dhs  
1. User is registered and 
does have a <b>session ID</b>
2. state of conference is <b>"session-open".
end note 
group 4. <b>Initiate audio video conference RESUME  
browser->apig : <b>HTTP PUT</b>   /v1/sessions/sessionId/mediaConferences/{confId}(sdp->a:sendrecv,header:initiate-conference-resume)
note over apig 
    modified SDP[a:sendrecv] - sent 
    to the peer over the
    <b>event channel, if present
end note
apig-->browser :HTTP 204 No Content (state:mod-sent,modID)

end


note over browser,dhs  
1. User is registered and 
does have a <b>session ID</b>
2. state of conference is <b>"session-open".
end note 
group 5. <b>Accept conference modification  
browser->apig : <b>HTTP PUT</b>   /v1/sessions/sessionId/mediaConferences/{confId}(modID,sdp,header:accept-conference-mod)
note over apig 
    modified SDP,modID - sent 
    to the peer over the
    <b>event channel, if present
end note
apig-->browser :HTTP 204 No Content (state:mod-accepted)

end

note over browser,dhs  
1. User is registered and 
does have a <b>session ID</b>
2. state of conference is <b>"session-open".
end note 
group 6. <b>Reject/Cancel conference modification  
browser->apig : <b>HTTP PUT</b>   /v1/sessions/sessionId/mediaConferences/{confId}(modID,sdp,header:rejectCancel-conference-mod)
note over apig 
    Reject modID - sent 
    to the peer over the
    <b>event channel, if present
end note
apig-->browser :HTTP 204 No Content

end

note over browser,dhs  
1. User is registered and 
does have a <b>session ID</b>
2. state of call is <b>"session-open".
end note 
group 7. <b>Move media conference session to different end point  
group <b>STEP 1 --> PUT CALL ON HOLD
browser->apig : <b>HTTP PUT</b>   /v1/sessions/sessionId/mediaConferences/{confId}(sdp->a:recvonly,header:initiate-call-hold)
note over apig 
    modified SDP[a:recvonly] - sent 
    to the peer over the
    <b>event channel, if present
end note
apig-->browser :HTTP 204 No Content (state:mod-sent,modID)
end
note over browser,apig
    1. Sessions are active on another endpoint to get media conference move invitation.
    2. Termination of media conference session should happen in a specified duration (less than 5 sec).
end note
group <b>STEP 2 --> TERMINATE MEDIA CONFERENCE SESSION
browser->apig : <b>HTTP DELETE</b>   /v1/sessions/sessionId/mediaConferences/{confId}
apig-->browser :HTTP 200 OK 
end

note over browser,apig
1. Other Endpoints having active session registered with same username/VTN/ICMN 
 starts ringing.
2. Conference is moved to the end point that answers the call first.
end note

end

@enduml