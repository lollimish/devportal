@startuml


hide footbox

title Make a Call
participant "<b>WebRTC App1 - Calling user" as caller
participant "<b>APIGW" as apig
participant "<b>WebRTC App2 - Called Party" as called

autonumber

note over caller
<b>Pre-Conditions
1. oAUTH Token is successfully 
allocated to the user.
2. User Session is registered.
end note
group start a call
caller->apig:POST /sessions/{sessionId}/calls/
apig-->caller:202 Accepted (callId)
end
note over called
In case Called Party is a 
webRTC user an Event will 
be received on the event channel
end note

called->called : user receives alert

called->called : user answers
note over called
In case Called Party is a 
webRTC client a HTTP PUT on calls/callId
indicating answer in the header will 
be triggered towards APIGW
end note


group event(long polling) received - answer
caller->apig:GET /sessions/{sessionId}/events/
apig-->caller:200 Ok (session-open,Connection IP address) 
end

note over caller,called
<b>Establish Media Path for communication (voicevideo)
end note

group End Call
caller->apig: DELETE /sessions/{sessionId}/calls/{callId}
apig-->caller: HTTP Ok
note over caller
Called Party can also terminate
the call , in that case event will be 
received over the event channel.
end note
end


@enduml